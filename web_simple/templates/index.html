<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <div class="search-container">
        <input type="text" id="question" class="search-box" placeholder="Enter your question" onkeydown="handleKeyPress(event)">
    </div>

    <!-- 답변 결과 및 레퍼런스는 아래에 표시 -->
    <div id="answer-section">
        <p id="answer" class="answer-text"></p>
        <p id="references-title">References</p>
        <ul id="references" class="faded-references"></ul>
    </div>

    <script>
        // Enter 키로 질문 제출하기
        function handleKeyPress(event) {
            if (event.key === "Enter") {
                askQuestion();
            }
        }

        // 질문을 서버에 전송하는 함수
        function askQuestion() {
            const question = document.getElementById("question").value;

            if (!question) {
                alert("Please enter a question.");
                return;
            }

            // 로딩 애니메이션 적용
            document.getElementById("question").classList.add("loading");
            document.getElementById("answer").innerText = "";
            document.getElementById("references").innerHTML = "";
            document.getElementById("references-title").style.display = "none"; // 레퍼런스 제목 숨기기

            // 서버에 질문을 전달
            fetch("/ask", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ question: question })
            }).then(response => response.json())
            .then(data => {
                // 로딩 애니메이션 제거
                document.getElementById("question").classList.remove("loading");
                
                if (data.error) {
                    alert(data.error);
                } else {
                    // 답변 표시

                    console.log(data);

                    document.getElementById("answer").innerText = data.answer;

                    // 레퍼런스 데이터를 추가로 렌더링
                    const referencesList = document.getElementById("references");
                    referencesList.innerHTML = '';  // 기존 레퍼런스 제거

                    if (data.references && data.references.length > 0) {
                        // 레퍼런스 제목 표시
                        document.getElementById("references-title").style.display = "block";
                        data.references.forEach(ref => {
                            const listItem = document.createElement('li');
                            listItem.textContent = ref;  // 레퍼런스 항목 추가
                            referencesList.appendChild(listItem);
                        });
                    } else {
                        document.getElementById("references-title").style.display = "none";
                        referencesList.innerHTML = '<li>No references found.</li>';
                    }
                }
            }).catch(err => {
                // 에러 발생 시 로딩 애니메이션 제거
                document.getElementById("question").classList.remove("loading");
                alert("Error: " + err);
            });
        }
    </script>
</body>
</html>